<!doctype html>
<html lang="pl">
<head>
    <meta charset="utf-8">
    <title>Panel przetwarzania danych</title>
    <link rel="stylesheet" href="./style.css">
    <script src="./chart.js"></script>
</head>
<body>
<div class="app">

    <!-- GÓRNY PASEK -->
    <header class="top-bar">
        <div class="top-bar-inner">
            <h1>Panel przetwarzania danych</h1>

            <div class="top-bar-db">
                <div class="db-select-group">
                    <span class="db-label">Wybór bazy:</span>
                    <select name="baza" id="baza">
                        <option>Testowa baza 1</option>
                        <option>Testowa baza 2</option>
                    </select>
                </div>
                <label class="db-connect">
                    <input type="checkbox" name="polacz_baza">
                    Połącz z bazą
                </label>
            </div>
        </div>
    </header>

    <!-- TRZY GÓRNE PANELE -->
    <main class="main">

        <!-- LEWY PANEL: WYBÓR PRZETWORNIKA -->
        <section class="panel panel-left">
            <h2>Wybór przetwornika</h2>

            <div class="panel-left-content">
                <!-- LEWA STRONA – LISTA W SCROLLU -->
                <div class="transducers-scroll">
                    <div class="transducers-list">
                        <label><input type="checkbox"> Przetwornik 1</label>
                        <label><input type="checkbox"> Przetwornik 2</label>
                        <label><input type="checkbox"> Przetwornik 3</label>
                        <label><input type="checkbox"> Przetwornik 4</label>
                        <label><input type="checkbox"> Przetwornik 5</label>
                        <label><input type="checkbox"> Przetwornik 6</label>
                        <label><input type="checkbox"> Przetwornik 7</label>
                        <label><input type="checkbox"> Przetwornik 8</label>
                        <label><input type="checkbox"> Przetwornik 9</label>
                        <label><input type="checkbox"> Przetwornik 10</label>
                        <label><input type="checkbox"> Przetwornik 11</label>
                        <label><input type="checkbox"> Przetwornik 12</label>
                        <label><input type="checkbox"> Przetwornik 13</label>
                        <label><input type="checkbox"> Przetwornik 14</label>
                        <label><input type="checkbox"> Przetwornik 15</label>
                        <label><input type="checkbox"> Przetwornik 16</label>
                        <label><input type="checkbox"> Przetwornik 17</label>
                        <label><input type="checkbox"> Przetwornik 18</label>
                        <label><input type="checkbox"> Przetwornik 19</label>
                        <label><input type="checkbox"> Przetwornik 20</label>
                    </div>
                </div>

                <!-- PRAWA STRONA – KOLUMNA PRZYCISKÓW -->
                <div class="panel-left-buttons">
                    <button type="button">Wczytaj listę</button>
                    <button type="button">Zaznacz wszystkie</button>
                    <button type="button">Odznacz wszystkie</button>
                    <button type="button">Zapisz</button>
                </div>
            </div>
        </section>

        <!-- ŚRODKOWY PANEL: WYBÓR DATY I GODZINY -->
        <section class="panel panel-middle">
            <h2>Wybór daty i godziny</h2>

            <!-- CUSTOM KALENDARZ -->
            <div class="form-group calendar-group">
                <label for="data">Data</label>
                <div class="calendar-wrapper">
                    <input type="text" id="data" name="data" placeholder="RRRR-MM-DD" readonly>

                    <div id="custom-calendar" class="custom-calendar hidden">
                        <div class="calendar-header">
                            <button type="button" class="cal-nav cal-prev">&lt;</button>
                            <div class="cal-month-year">
                                <span class="cal-month"></span>
                                <span class="cal-year"></span>
                            </div>
                            <button type="button" class="cal-nav cal-next">&gt;</button>
                        </div>

                        <div class="calendar-weekdays">
                            <span>Pn</span><span>Wt</span><span>Śr</span><span>Cz</span><span>Pt</span><span>So</span><span>Nd</span>
                        </div>

                        <div class="calendar-days"></div>
                    </div>
                </div>
            </div>

            <div class="form-group time-row">
                <div class="time-col">
                    <label for="startTime">Wybór godziny i minuty (początek)</label>
                    <input type="time" id="startTime" name="startTime">
                </div>
                <div class="time-col-button">
                    <button type="button">Początek</button>
                </div>
            </div>

            <div class="form-group time-row">
                <div class="time-col">
                    <label for="endTime">Wybór godziny i minuty (koniec)</label>
                    <input type="time" id="endTime" name="endTime">
                </div>
                <div class="time-col-button">
                    <button type="button">Koniec</button>
                </div>
            </div>
        </section>

        <!-- PRAWY PANEL: POSTĘP -->
        <section class="panel panel-right">
            <h2>Postęp</h2>

            <div class="progress-log">
                <div class="progress-log-window">
                    <!-- docelowo tutaj będziemy dopisywać log z przetwarzania -->
                    <p>Rozpoczęto przetwarzanie...</p>
                    <p>Przetwornik 1 zapisany...</p>
                    <p>Przetwornik 2 zapisany...</p>
                    <p>...</p>
                </div>

                <div class="progress-bar-wrapper">
                    <div class="progress-bar">
                        <div class="progress-bar-fill" style="width: 40%;"></div>
                    </div>
                    <span class="progress-bar-label">40%</span>
                </div>
            </div>
        </section>

    </main>

    <!-- PANEL: WYBÓR PRZETWORNIKÓW DO WYKRESU -->
    <section class="panel panel-chart-filters">
        <h2>Wybór przetworników do prezentacji na wykresie</h2>
        <div class="form-group">
            <div class="transducers-list wykres-lista">
                <label><input type="checkbox"> Przetwornik 1</label>
                <label><input type="checkbox"> Przetwornik 2</label>
                <label><input type="checkbox"> Przetwornik 3</label>
                <label><input type="checkbox"> Przetwornik 4</label>
                <label><input type="checkbox"> Przetwornik 3</label>
                <label><input type="checkbox"> Przetwornik 4</label>
            </div>
        </div>
    </section>

    <!-- PANEL: WYKRES (CAŁA SZEROKOŚĆ) -->
    <section class="panel panel-chart">
        <h2>Wykres przetwarzanych danych</h2>
        <div class="chart-wrapper">
            <canvas id="mainChart"></canvas>
        </div>
    </section>

</div>

<!-- SKRYPT TWORZĄCY WYKRES + KALENDARZ -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    // === WYKRES ===
    const rootStyles = getComputedStyle(document.documentElement);
    const akcent = rootStyles.getPropertyValue('--akcent').trim();
    const tekst2 = rootStyles.getPropertyValue('--tekst2').trim();

    const ctx = document.getElementById('mainChart').getContext('2d');

    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Rekord 1', 'Rekord 2', 'Rekord 3', 'Rekord 4', 'Rekord 5', 'Rekord 6'],
            datasets: [
                {
                    label: 'Wartość po przetworzeniu',
                    data: [120, 150, 90, 200, 170, 140],
                    borderWidth: 2,
                    tension: 0.25,
                    pointRadius: 4,
                    pointHoverRadius: 5,
                    fill: true,
                    borderColor: akcent,
                    backgroundColor: 'rgba(244, 207, 2, 0.15)'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: tekst2
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        color: tekst2
                    },
                    grid: {
                        color: 'rgba(255,255,255,0.04)'
                    }
                },
                y: {
                    ticks: {
                        color: tekst2
                    },
                    grid: {
                        color: 'rgba(255,255,255,0.06)'
                    }
                }
            }
        }
    });

    // === CUSTOM KALENDARZ ===
    const dateInput = document.getElementById('data');
    const calendarEl = document.getElementById('custom-calendar');
    const monthLabel = calendarEl.querySelector('.cal-month');
    const yearLabel = calendarEl.querySelector('.cal-year');
    const daysContainer = calendarEl.querySelector('.calendar-days');
    const prevBtn = calendarEl.querySelector('.cal-prev');
    const nextBtn = calendarEl.querySelector('.cal-next');

    let currentDate = new Date();
    let selectedDate = null;

    const monthNames = [
        "Styczeń", "Luty", "Marzec", "Kwiecień",
        "Maj", "Czerwiec", "Lipiec", "Sierpień",
        "Wrzesień", "Październik", "Listopad", "Grudzień"
    ];

    function pad(n) {
        return n < 10 ? "0" + n : "" + n;
    }

    function renderCalendar(date) {
        const year = date.getFullYear();
        const month = date.getMonth();

        monthLabel.textContent = monthNames[month];
        yearLabel.textContent = year;

        const firstDay = new Date(year, month, 1);
        const startDay = (firstDay.getDay() + 6) % 7; // poniedziałek = 0
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const daysInPrevMonth = new Date(year, month, 0).getDate();

        daysContainer.innerHTML = "";

        // dni z poprzedniego miesiąca
        for (let i = 0; i < startDay; i++) {
            const dayNum = daysInPrevMonth - startDay + 1 + i;
            const div = document.createElement('div');
            div.className = 'calendar-day other-month';
            div.textContent = dayNum;
            daysContainer.appendChild(div);
        }

        // dni bieżącego miesiąca
        const today = new Date();
        for (let d = 1; d <= daysInMonth; d++) {
            const div = document.createElement('div');
            div.className = 'calendar-day';
            div.textContent = d;

            const thisDate = new Date(year, month, d);

            // dzisiaj
            if (
                thisDate.getFullYear() === today.getFullYear() &&
                thisDate.getMonth() === today.getMonth() &&
                thisDate.getDate() === today.getDate()
            ) {
                div.classList.add('today');
            }

            // zaznaczona data
            if (
                selectedDate &&
                thisDate.getFullYear() === selectedDate.getFullYear() &&
                thisDate.getMonth() === selectedDate.getMonth() &&
                thisDate.getDate() === selectedDate.getDate()
            ) {
                div.classList.add('selected');
            }

            div.addEventListener('click', () => {
                selectedDate = thisDate;
                dateInput.value = `${year}-${pad(month + 1)}-${pad(d)}`;
                calendarEl.classList.add('hidden');
                renderCalendar(currentDate); // odśwież, żeby selected się pokazał
            });

            daysContainer.appendChild(div);
        }

        // uzupełnienie końca siatki
        const totalCells = startDay + daysInMonth;
        const rest = totalCells % 7;
        if (rest !== 0) {
            const nextDays = 7 - rest;
            for (let i = 1; i <= nextDays; i++) {
                const div = document.createElement('div');
                div.className = 'calendar-day other-month';
                div.textContent = i;
                daysContainer.appendChild(div);
            }
        }
    }

    // otwieranie / zamykanie kalendarza
    if (dateInput) {
        dateInput.addEventListener('click', () => {
            calendarEl.classList.toggle('hidden');
        });
    }

    prevBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
    });

    nextBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
    });

    // klik poza kalendarz = zamknij
    document.addEventListener('click', (e) => {
        if (!calendarEl.contains(e.target) && e.target !== dateInput) {
            calendarEl.classList.add('hidden');
        }
    });

    // pierwsze renderowanie
    renderCalendar(currentDate);
});
</script>

</body>
</html>

